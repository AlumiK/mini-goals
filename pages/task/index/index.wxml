<!--pages/task/index/index.wxml-->

<view class="page">
    <view class="page__bd">
        <view class="weui-search-bar search">
            <view class="weui-search-bar__form">
                <view class="weui-search-bar__box">
                    <icon class="weui-icon-search_in-box" type="search" size="14"></icon>
                    <input type="text" class="weui-search-bar__input" placeholder="搜索" value="{{m_name}}" focus="{{m_search_showed}}" bindinput="inputTyping" bindconfirm="applySearch" />
                    <view class="weui-icon-clear" wx:if="{{m_name.length > 0}}" bindtap="clearInput">
                        <icon type="clear" size="14"></icon>
                    </view>
                </view>
                <label class="weui-search-bar__label" hidden="{{m_search_showed}}" bindtap="showInput">
                    <icon class="weui-icon-search" type="search" size="14"></icon>
                    <view class="weui-search-bar__text">搜索</view>
                </label>
            </view>
            <view class="weui-search-bar__cancel-btn" hidden="{{!m_search_showed}}" bindtap="hideInput">取消</view>
        </view>

        <view class="weui-cells weui-cells_after-title add-task-list">
            <view class="weui-cell weui-cell_input">
                <view class="weui-cell__bd">
                    <input class="weui-input" placeholder="新建目标清单" bindinput="createTaskListTyping" bindconfirm="createTaskList" value="{{m_create_task_list_str}}" />
                </view>
                <view class="weui-cell__ft">
                    <text class="fa fa-lg fa-plus-square-o text-secondary" bindtap="createTaskList"></text>
                </view>
            </view>
        </view>

        <view wx:if="{{m_labels.length > 0}}" class="all-labels">
            <view class="badge badge-pill {{m_label == 0 ? 'badge-info' : 'badge-secondary'}} label" bindtap="applyLabel" data-id="0">全部</view>
            <view wx:for="{{m_labels}}" wx:key="id" wx:for-item="label" class="badge badge-pill {{m_label == label.id ? 'badge-info' : 'badge-secondary'}} label" bindtap="applyLabel" data-id="{{label.id}}">{{label.name}}</view>
        </view>

        <view wx:for="{{m_task_lists}}" wx:key="id" wx:for-item="task_list" class="weui-panel weui-panel_access">
            <view class="weui-panel__hd task-list__hd">
                {{task_list.name}}
                <view class="pull-right">
                    <text class="fa-lg text-secondary fa fa-angle-up sort-arrow" bindtap="sortTaskList" data-dir="{{-1}}" data-index="{{index}}"></text>
                    <text class="fa-lg text-secondary fa fa-angle-down sort-arrow" bindtap="sortTaskList" data-dir="{{1}}" data-index="{{index}}"></text>
                </view>
            </view>
            <view class="weui-panel__bd">
                <view class="weui-media-box weui-media-box_text">
                    <view wx:if="{{task_list.grouped_tasks.unfinished.count + task_list.grouped_tasks.finished.count > 0}}">
                        <view wx:for="{{task_list.grouped_tasks.unfinished.content}}" wx:key="id" wx:for-item="task" class="weui-media-box__title weui-media-box__title_in-text task">
                            <text class="fa fa-square-o task-checkbox" bindtap="finishTask" data-id="{{task.id}}"></text>{{task.content}}
                        </view>
                        <view wx:if="{{task_list.grouped_tasks.unfinished.count > 5}}" class="weui-media-box__desc task-list__brief">+{{task_list.grouped_tasks.unfinished.count - 5}} 项待完成
                        </view>
                        <view wx:if="{{task_list.grouped_tasks.finished.count > 0}}" class="weui-media-box__desc task-list__brief">{{task_list.grouped_tasks.finished.count}} 项已完成
                        </view>
                    </view>
                    <view wx:else class="weui-media-box__desc task-list__brief">清单内容为空</view>
                    <view wx:if="{{task_list.labels.length > 0}}" class="badges">
                        <view wx:for="{{task_list.labels}}" wx:key="id" wx:for-item="label" class="badge badge-pill badge-success label" bindtap="applyLabel" data-id="{{label.id}}">{{label.name}}</view>
                    </view>
                </view>
            </view>
            <view class="weui-panel__ft">
                <view class="weui-cell weui-cell_access weui-cell_link" bindtap="viewTaskList" data-id="{{task_list.id}}">
                    <view class="weui-cell__bd">查看详情</view>
                    <view class="weui-cell__ft weui-cell__ft_in-access"></view>
                </view>
            </view>
        </view>
    </view>
</view>